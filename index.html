<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- Redirecionamento automático removido. -->

    <title>Karu Idle JS Game</title>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            background: url('assets/bg2.png') center/cover no-repeat fixed, #1a1333;
            min-height: 100vh;
            margin: 0;
            font-family: 'Press Start 2P', monospace;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #auth-container {
            background: rgba(30, 20, 60, 0.95);
            border: 4px solid #a84cff;
            border-radius: 18px;
            box-shadow: 0 0 32px #a84cff99, 0 0 8px #000;
            padding: 40px 32px 32px 32px;
            min-width: 340px;
            max-width: 95vw;
            text-align: center;
            position: relative;
        }
        .avatar-preview {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 0 16px #a84cff;
            margin: 0 auto 18px auto;
            background: #222 url('assets/avatar/avatar0.png') center/cover no-repeat;
        }
        h2 {
            font-family: 'Press Start 2P', monospace;
            color: #ffe066;
            margin-bottom: 18px;
            text-shadow: 2px 2px 0 #a84cff, 0 0 8px #000;
        }
        label {
            display: block;
            margin: 12px 0 4px 0;
            font-size: 13px;
            color: #a0a0ff;
        }
        input[type="text"], input[type="password"] {
            width: 80%;
            padding: 8px 10px;
            border-radius: 8px;
            border: 2px solid #a84cff;
            background: #2a1a44;
            color: #fff;
            font-size: 15px;
            margin-bottom: 10px;
            font-family: 'Press Start 2P', monospace;
        }
        button {
            background: linear-gradient(90deg, #a84cff 40%, #ffe066 100%);
            color: #222;
            border: none;
            border-radius: 8px;
            font-family: 'Press Start 2P', monospace;
            font-size: 15px;
            padding: 10px 32px;
            margin-top: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px #a84cff99;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        button:hover {
            background: linear-gradient(90deg, #ffe066 40%, #a84cff 100%);
            color: #1a1333;
        }
        #loginMessage, #registerMessage {
            min-height: 18px;
            color: #ffb3b3;
            font-size: 13px;
            margin-bottom: 8px;
        }
        a {
            color: #ffe066;
            text-decoration: underline;
            cursor: pointer;
        }
        a:hover {
            color: #a84cff;
        }
        @media (max-width: 500px) {
            #auth-container { padding: 18px 2vw; min-width: unset; }
            .avatar-preview { width: 64px; height: 64px; }
        }
    </style>

</head>
<body>
    <div id="auth-container">
        <div class="avatar-preview"></div>
        <div id="login-section">
            <h2>Login</h2>
            <form id="loginForm">
                <label for="login-username">Usuário</label>
                <input type="text" id="login-username" name="username" required>
                <label for="login-password">Senha</label>
                <input type="password" id="login-password" name="password" required>
                <button type="submit">Entrar</button>
            </form>
            <p id="loginMessage"></p>
            <p>Não tem conta? <a href="#" id="showRegister">Cadastre-se</a></p>
        </div>
        <div id="register-section" style="display:none;">
            <h2>Cadastro</h2>
            <form id="registerForm">
                <label for="register-username">Usuário</label>
                <input type="text" id="register-username" name="username" required>
                <label for="register-password">Senha</label>
                <input type="password" id="register-password" name="password" required>
                <button type="submit">Cadastrar</button>
            </form>
            <p id="registerMessage"></p>
            <p>Já tem conta? <a href="#" id="showLogin">Entrar</a></p>
        </div>
    </div>
    <script>
    // Alternar entre login e cadastro
    document.getElementById('showRegister').onclick = function(e) {
        e.preventDefault();
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('register-section').style.display = '';
    };
    document.getElementById('showLogin').onclick = function(e) {
        e.preventDefault();
        document.getElementById('register-section').style.display = 'none';
        document.getElementById('login-section').style.display = '';
    };

    // Login
    document.getElementById('loginForm').onsubmit = async function(e) {
        e.preventDefault();
        const username = document.getElementById('login-username').value;
        const password = document.getElementById('login-password').value;
        const res = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if (res.ok) {
            localStorage.setItem('token', data.token);
            window.location.href = 'SimpleIdleJSGame.html';
        } else {
            document.getElementById('loginMessage').textContent = data.error || 'Erro ao fazer login';
        }
    };

    // Cadastro
    document.getElementById('registerForm').onsubmit = async function(e) {
        e.preventDefault();
        const username = document.getElementById('register-username').value;
        const password = document.getElementById('register-password').value;
        const res = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if (res.ok) {
            document.getElementById('registerMessage').textContent = 'Cadastro realizado! Faça login.';
        } else {
            document.getElementById('registerMessage').textContent = data.error || 'Erro ao cadastrar';
        }
    };
    </script>
</body>
</html>
